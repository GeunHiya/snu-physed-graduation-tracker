// --- 아이콘 컴포넌트 ---
window.Icons = {
    Cap: () => <svg className="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 14l9-5-9-5-9 5 9 5z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm0 0V20"/></svg>,
    Book: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>,
    Check: ({ className = "text-green-500", size = 20 }) => <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>,
    Circle: ({ className = "text-slate-300", size = 20 }) => <svg width={size} height={size} className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth="2"/></svg>,
    Trash: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v2m3 3h8M4 7h16"/></svg>,
    Save: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>,
    Target: () => <svg className="w-6 h-6 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 12l2 2 4-4M7.835 4.697a.75.75 0 001.034-.141 11.96 11.96 0 0115.26 0 .75.75 0 101.033 1.085 13.46 13.46 0 00-17.327 0 .75.75 0 001.034-1.085z"/></svg>,
    Shield: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    Grip: () => <svg className="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><circle cx="9" cy="5" r="1" fill="currentColor"/><circle cx="9" cy="12" r="1" fill="currentColor"/><circle cx="9" cy="19" r="1" fill="currentColor"/><circle cx="15" cy="5" r="1" fill="currentColor"/><circle cx="15" cy="12" r="1" fill="currentColor"/><circle cx="15" cy="19" r="1" fill="currentColor"/></svg>,
    ArrowUp: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="3"><path strokeLinecap="round" strokeLinejoin="round" d="M5 15l7-7 7 7" /></svg>,
    Zap: () => <svg className="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
    User: () => <svg className="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    Layers: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>,
    Logout: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
    Mail: () => <svg className="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>,
    ChevronDown: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2.5"><path strokeLinecap="round" strokeLinejoin="round" d="M19 9l-7 7-7-7" /></svg>,
    Settings: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
};

// --- 입력 필드 렌더러 ---
window.CourseInputRenderer = ({ i, ck, handlers, getForeign2Options, studentYear, data }) => {
    const { handleForeignChange, updateName, handleMathChange, handleMSChange, handleCorePrefixChange, handleSubjectSelect, handleBasicEnglishYearChange } = handlers;
    
    if (i.id === 'g_be') {
        if (studentYear >= 24) return <div className="flex items-center gap-2 text-sm font-bold w-full"><span className="text-slate-700 shrink-0">기초 영어</span><span className="text-slate-400 text-xs"></span></div>;
        return <div className="flex items-center gap-2 text-sm font-bold w-full"><span className="text-slate-700 shrink-0">기초 영어</span><select value={i.takenYear || 'before23'} onChange={(e) => handleBasicEnglishYearChange(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg text-slate-600 text-xs font-medium"><option value="before23">2023학년도 이전 수강 (1pt)</option><option value="after24">2024학년도 이후 수강 (2pt)</option></select></div>;
    }
    if (i.type === 'foreign1') return <div className="flex items-center gap-2 text-sm font-bold"><span className="text-slate-400 shrink-0">외국어 1:</span><select value={i.subName} onChange={(e) => handleForeignChange(ck, i.id, 'subName', e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none font-bold">{FOREIGN1_OPTIONS.map(opt => <option key={opt} value={opt}>{opt === '면제' ? '제2외국어' : opt}</option>)}</select>{i.subName === '면제' && <input type="text" value={i.name || ''} onChange={(e) => updateName(ck, i.id, e.target.value)} className="bg-transparent border-none outline-none text-sm w-full font-bold input-underline focus:text-indigo-600 border-b border-transparent focus:border-transparent text-slate-700" placeholder="과목명..." />}</div>;
    if (i.type === 'foreign2') return <div className="flex items-center gap-2 text-sm font-bold w-full"><span className="text-slate-400 shrink-0">외국어 2:</span><select value={i.subName} onChange={(e) => handleForeignChange(ck, i.id, 'subName', e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none font-bold"><option value="" disabled>선택</option>{getForeign2Options().map(opt => <option key={opt} value={opt}>{opt}</option>)}</select>{i.subName === '제2외국어' && <input type="text" value={i.name || ''} onChange={(e) => updateName(ck, i.id, e.target.value)} className="bg-transparent border-none outline-none text-sm w-full font-bold input-underline focus:text-indigo-600 border-b border-transparent focus:border-transparent text-slate-700" placeholder="과목명..." />}</div>;
    if (i.type === 'mathSet') return <div className="flex items-center gap-2 text-sm font-bold"><select value={i.subName} onChange={(e) => handleMathChange(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none font-bold">{(i.id === 'g_m2' ? MATH2_PAIRS : MATH1_PAIRS).map(p => <option key={p.main} value={p.main}>{p.main}</option>)}</select></div>;
    if (i.type === 'msSet') return <div className="flex items-center gap-2 text-sm font-bold"><span className="text-slate-400 shrink-0">{i.name}:</span><select value={i.subName} onChange={(e) => handleMSChange(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none font-bold"><option value={i.subName} disabled>{i.subName}</option>{((studentYear === 23 || studentYear === 24) ? MS_OPTIONS.filter(o => ['물리학 1', '화학 1', '생물학 1', '지구과학'].includes(o.main)) : MS_OPTIONS).map(o => <option key={o.main} value={o.main}>{o.main}</option>)}</select></div>;
    if (i.type === 'physics1Select') return <div className="flex items-center gap-2 text-sm font-bold"><select value={i.name} onChange={(e) => updateName(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg focus:ring-2 focus:ring-indigo-100 outline-none font-bold"><option value="물리학 1">물리학 1</option><option value="고급물리학 1">고급물리학 1</option></select></div>;
    if (i.type === 'computer') return <div className="flex items-center gap-2 text-sm font-bold w-full"><span className="text-slate-400 shrink-0 font-bold">{i.prefix}:</span><select value={i.name} onChange={(e) => updateName(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg outline-none shrink-0 font-bold"><option value="선택" disabled>선택</option>{i.options.map(opt => <option key={opt} value={opt}>{opt}</option>)}</select></div>;
    if (i.type === 'keys') {
        const currentKeysItems = data[ck].items.filter(item => item.type === 'keys');
        const selectedOptions = currentKeysItems.map(item => item.prefix).filter(p => KEYS_OPTIONS.includes(p));
        const availableOptions = KEYS_OPTIONS.map(opt => ({ value: opt, disabled: selectedOptions.includes(opt) && opt !== i.prefix }));
        return <div className="flex items-center gap-2 text-sm font-bold w-full"><select value={i.prefix} onChange={e => handleCorePrefixChange(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg outline-none shrink-0 font-bold"><option value={i.prefix} disabled hidden>{i.prefix}</option>{availableOptions.map(opt => <option key={opt.value} value={opt.value} disabled={opt.disabled}>{opt.value}</option>)}</select><span className="text-slate-400">:</span><input type="text" value={i.name} onChange={e => updateName(ck, i.id, e.target.value)} className="bg-transparent border-none outline-none text-sm w-full font-bold input-underline focus:text-indigo-600 border-b border-transparent focus:border-transparent text-slate-700" placeholder="과목명..." /></div>;
    }
    if (i.type === 'core' || i.type === 'pe' || i.type === 'veritas') return <div className="flex items-center gap-2 text-sm font-bold w-full">{i.options ? <select value={i.prefix} onChange={e => handleCorePrefixChange(ck, i.id, e.target.value)} className="bg-slate-100 px-2 py-1 rounded-lg outline-none shrink-0 font-bold">{i.options.map(opt => <option key={opt} value={opt}>{opt}</option>)}</select> : <span className="text-slate-400 shrink-0 font-bold">{i.prefix}</span>}<span className="text-slate-400">:</span><input type="text" value={i.name} onChange={e => updateName(ck, i.id, e.target.value)} className="bg-transparent border-none outline-none text-sm w-full font-bold input-underline focus:text-indigo-600 border-b border-transparent focus:border-transparent text-slate-700" placeholder="과목명..." /></div>;
    if (i.type === 'coreFixed') return <div className="flex items-center gap-2 text-sm font-bold w-full"><span className="text-slate-400 shrink-0 font-bold">{i.prefix}</span><input type="text" value={i.name} onChange={e => updateName(ck, i.id, e.target.value)} className="bg-transparent border-none outline-none text-sm w-full font-bold input-underline focus:text-indigo-600 border-b border-transparent focus:border-transparent text-slate-700" placeholder="과목명..." /></div>;
    if (i.selectable) return <select value={i.name.includes('[') ? '' : i.name} onChange={(e) => handleSubjectSelect(ck, i.id, e.target.value)} className={`bg-slate-50 border-none outline-none text-sm font-bold text-slate-700 py-1 px-2 rounded-lg focus:ring-2 focus:ring-indigo-100 ${i.completed ? 'text-slate-300 font-normal' : ''}`}><option value="" disabled>{i.name}</option>{PHYSICS_ED_CHOICES.map(opt => <option key={opt.name} value={opt.name}>{opt.name} ({opt.credits}pt)</option>)}</select>;
    return <input type="text" value={i.name} readOnly={i.fixedName || i.fixed} onChange={e => updateName(ck, i.id, e.target.value)} draggable={false} placeholder={i.placeholder} className={`bg-transparent border-none outline-none text-sm w-full font-bold focus:text-indigo-600 ${!i.fixedName && !i.fixed ? 'input-underline border-b border-transparent focus:border-transparent' : ''} ${(i.completed || (i.multi && i.checks?.every(c => c))) ? 'text-slate-300 line-through font-normal' : (i.placeholder && !i.name ? 'text-gray-400' : 'text-slate-700')} ${i.fixed && !i.deleteMsg ? 'cursor-default' : ''}`} />;
};